<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>رفع صور الجاليري - Gresan Admin</title>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <!-- Font (optional) -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      padding: 40px 20px;
      background: #0e0e0e url('img/GRESAN--black.png') center center fixed;
      background-size: 400px;
      color: #fff;
      min-height: 100vh;
    }

    h1 {
      font-size: 30px;
      margin-bottom: 20px;
      color: #f1c40f;
      text-align: center;
      animation: fadeInDown 1s;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background-color: rgba(255, 255, 255, 0.03);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.05);
      animation: fadeInUp 1s;
    }

    input[type="file"], button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-top: 10px;
      border: none;
      border-radius: 10px;
    }

    input[type="file"] {
      background-color: #fff;
      color: #000;
    }

    button {
      background-color: #f1c40f;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #d4ac0d;
    }

    .gallery {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 30px;
    }

    .gallery img {
      width: 220px;
      margin: 10px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
      animation: zoomIn 1s;
    }

    @media (max-width: 600px) {
      .gallery img {
        width: 90%;
      }
    }
  </style>
</head>
<body class="animate__animated animate__fadeIn">

<script>
  const pass = prompt("ادخل كلمة السر:");
  if (pass !== "gresan2025") {
    alert("🚫 دخول مرفوض");
    window.location.href = "/";
  }
</script>

<div class="container">
  <h1>📤 لوحة تحكم صور الجاليري - GRESAN</h1>

  <input type="file" id="imageInput" accept="image/*">
  <button onclick="uploadImage()">رفع الصورة</button>

  <div class="gallery" id="gallery"></div>
</div>

<script>
  const SUPABASE_URL = "https://aqqjgljqnihrfsypdocx.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFxcWpnbGpxbmlocmZzeXBkb2N4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwMDMwMjEsImV4cCI6MjA2NzU3OTAyMX0.KOcX7vux8I94abQz-SFWBj3rppNLnM0MnEsEP3Dg7sU";

  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  async function uploadImage() {
    const file = document.getElementById('imageInput').files[0];
    if (!file) return alert("📎 اختر صورة!");

    const fileName = `${Date.now()}-${file.name}`;

    const { data, error } = await supabase
      .storage
      .from('gallery')
      .upload(`gallery/${fileName}`, file);

    if (error) {
      alert("❌ فشل في الرفع: " + error.message);
      return;
    }

    alert("✅ تم رفع الصورة بنجاح");
    loadGallery();
  }

  async function loadGallery() {
    const container = document.getElementById("gallery");
    container.innerHTML = "⏳ جاري تحميل الصور...";

    const { data, error } = await supabase
      .storage
      .from('gallery')
      .list('gallery/', { limit: 100, offset: 0 });

    if (error) {
      container.innerHTML = "⚠️ خطأ في تحميل الصور";
      return;
    }

    container.innerHTML = "";
    data.forEach(file => {
      const url = `${SUPABASE_URL}/storage/v1/object/public/gallery/${file.name}`;
      const img = document.createElement("img");
      img.src = url;
      container.appendChild(img);
    });
  }

  loadGallery();
</script>

</body>
</html>
